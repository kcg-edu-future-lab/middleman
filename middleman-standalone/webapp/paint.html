<!DOCTYPE html>
<html lang="ja">
<head>
<meta encoding="utf-8">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<style>
body {
  padding-top: 40px;
  padding-bottom: 30px;
}
#log {
    padding:5px;
    border:solid 1px #000;
    width:460px;
    height:150px;
    overflow:auto;
}
#canvas{
  border: solid 1px;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="middleman.js"></script>
</head>
<body>

<canvas id="canvas" width="640" height="480"></canvas>

<script>
class DrawCanvas{
	constructor(canvas){
		this.ctx = canvas.getContext("2d");
		canvas.addEventListener("mousedown", e => {
			this.dragging = true;
		});
		canvas.addEventListener("mouseup", e => {
			this.dragging = false;
		});
		canvas.addEventListener("mousemove", e => {
			if(this.dragging){
				this.draw(e.offsetX, e.offsetY);
			}
		});
	}

	draw(x, y){
		this.ctx.beginPath();
		this.ctx.arc(x, y, 2, 0, Math.PI*2, true);
		this.ctx.fill();
	}
}

$(function(){
	const service = "simplePaint";
	const room = "2oir094";
	const m = new Middleman(service, room);

	const canvas = new DrawCanvas(document.querySelector("#canvas"));
	canvas.draw = m.proxy(canvas.draw.bind(canvas));
});
</script>
</body>
</html>
